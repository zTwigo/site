<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Auth</title>
        <style>
            body{
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                background-color: red;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script>
            function checkSub(access_token){
                console.log(access_token);
                var xhr = new XMLHttpRequest();
                xhr.open("GET","https://api.twitch.tv/helix/users");
                xhr.setRequestHeader('Authorization',`Bearer ${access_token}`);
                xhr.setRequestHeader('Client-Id','uafnm4vbjmgy88vuk1v12z7cioqoq3');
                xhr.onload = () => {
                    var response = JSON.parse(xhr.response);
                    var id = response['data'][0]['id'];
                    var xhrr = new XMLHttpRequest();
                    xhrr.open("GET",`https://api.twitch.tv/helix/subscriptions/user?broadcaster_id=91067012&user_id=${id}`);
                    xhrr.setRequestHeader('Authorization',`Bearer ${access_token}`);
                    xhrr.setRequestHeader('Client-Id','uafnm4vbjmgy88vuk1v12z7cioqoq3');
                    xhrr.onload = () => {
                        console.log(xhrr.response);
                        var response = JSON.parse(xhrr.response);
                        var sub = response['data'][0]['tier'];
                        if(xhr.status === 404){
                            document.body.innerHTML = 'povero';
                        }else{
                            if(sub === '1000'){
                            document.body.innerHTML = 'FJSAHFSA';
                        }
                        }
                }
                xhrr.send();
                }
                xhr.send();
            }
            const text = document.querySelector("#findme");
            const result = document.location.hash.toString()
            .split("&")
            .map(v => v.split("="))
            .reduce( (pre, [key, value]) => ({ ...pre, [key]: value }), {} );
            console.log(result);
            var access_token = result['#access_token'];
            checkSub(access_token);
        </script>
    </head>
    <body>
        
    </body>
</html>