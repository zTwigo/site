<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="styles/general.css">
        <script scr="index.js"></script>
        <title>Sub ragesh</title>
    </head>
    <body>
        <a href="https://id.twitch.tv/oauth2/authorize?client_id=uafnm4vbjmgy88vuk1v12z7cioqoq3&redirect_uri=https%3A%2F%2Fsubragesh.netlify.app%2Fauth&response_type=token&force_verify=true&scope=user%3Aread%3Asubscriptions" target="_blank" rel="noopener noreferrer"><button>
            Verify now
            </button>
        </a>
        <!-- Login widget -->
        <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="ragesssbot" data-size="medium" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
        <script type="text/javascript">
            function insertData(id_telegram){
                console.log("Hello");

                const db = mysql.createConnection({
                    host: "localhost",
                    user: "root",
                    password: "",
                    database: "ragesh_sub"
                });

                db.query(`INSERT INTO abbonati (id_twitch,${id_telegram},sub) VALUES(2,3,'hello')`, (err,res) => {
                    return console.log(err + res);
            });
            }
            function onTelegramAuth(user) {
                let id_telegram = user.id;
                sessionStorage.setItem("telegram_id",id_telegram);
                console.log(id_telegram);
                alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user. id + (user.username ? ', @' + user.username : '') + ')');
            }
        </script>
    </body>
</html>